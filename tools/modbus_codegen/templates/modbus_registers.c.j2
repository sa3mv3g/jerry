/**
 * @file {{ config.device.name | lower }}_registers.c
 * @brief Modbus register data storage for {{ config.device.name }}
 *
 * This file is auto-generated by modbus_codegen.py
 * DO NOT EDIT MANUALLY
 *
 * Device: {{ config.device.name }}
 * Description: {{ config.device.description | default("") }}
 * Version: {{ config.device.version | default("1.0.0") }}
 *
 * @copyright Copyright (c) 2026
 */

#include "{{ config.device.name | lower }}_registers.h"
#include <string.h>

/* ==========================================================================
 * Static Data Storage
 * ========================================================================== */

{% if config.stats.num_coils > 0 %}
/** Coils data storage */
static {{ config.device.name | lower }}_coils_t s_coils;

{% endif %}
{% if config.stats.num_discrete_inputs > 0 %}
/** Discrete inputs data storage */
static {{ config.device.name | lower }}_discrete_inputs_t s_discrete_inputs;

{% endif %}
{% if config.stats.num_holding_registers > 0 %}
/** Holding registers data storage */
static {{ config.device.name | lower }}_holding_registers_t s_holding_registers;

{% endif %}
{% if config.stats.num_input_registers > 0 %}
/** Input registers data storage */
static {{ config.device.name | lower }}_input_registers_t s_input_registers;

{% endif %}
/* ==========================================================================
 * Initialization
 * ========================================================================== */

void {{ config.device.name | lower }}_registers_init(void)
{
{% if config.stats.num_coils > 0 %}
    /* Initialize coils with default values */
    (void)memset(&s_coils, 0, sizeof(s_coils));
{% for coil in config.registers.coils %}
{% if coil.default_value is defined and coil.default_value %}
    s_coils.{{ coil.name | lower }} = true;
{% endif %}
{% endfor %}

{% endif %}
{% if config.stats.num_discrete_inputs > 0 %}
    /* Initialize discrete inputs */
    (void)memset(&s_discrete_inputs, 0, sizeof(s_discrete_inputs));

{% endif %}
{% if config.stats.num_holding_registers > 0 %}
    /* Initialize holding registers with default values */
    (void)memset(&s_holding_registers, 0, sizeof(s_holding_registers));
{% for reg in config.registers.holding_registers %}
{% if reg.default_value is defined and reg.default_value != 0 %}
{% if reg.data_type == "float32" %}
    s_holding_registers.{{ reg.name | lower }} = {{ reg.default_value }}f;
{% else %}
    s_holding_registers.{{ reg.name | lower }} = {{ reg.default_value }};
{% endif %}
{% endif %}
{% endfor %}

{% endif %}
{% if config.stats.num_input_registers > 0 %}
    /* Initialize input registers */
    (void)memset(&s_input_registers, 0, sizeof(s_input_registers));

{% endif %}
}

/* ==========================================================================
 * Data Access Functions
 * ========================================================================== */

{% if config.stats.num_coils > 0 %}
{{ config.device.name | lower }}_coils_t* {{ config.device.name | lower }}_get_coils(void)
{
    return &s_coils;
}

{% endif %}
{% if config.stats.num_discrete_inputs > 0 %}
{{ config.device.name | lower }}_discrete_inputs_t* {{ config.device.name | lower }}_get_discrete_inputs(void)
{
    return &s_discrete_inputs;
}

{% endif %}
{% if config.stats.num_holding_registers > 0 %}
{{ config.device.name | lower }}_holding_registers_t* {{ config.device.name | lower }}_get_holding_registers(void)
{
    return &s_holding_registers;
}

{% endif %}
{% if config.stats.num_input_registers > 0 %}
{{ config.device.name | lower }}_input_registers_t* {{ config.device.name | lower }}_get_input_registers(void)
{
    return &s_input_registers;
}

{% endif %}
